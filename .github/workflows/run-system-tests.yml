# ~~ Generated by projen. To modify, edit .projenrc.py and run "npx projen".

name: run-system-tests
on:
  workflow_dispatch:
    inputs:
      sys_test_env:
        type: string
        description: Environment of your service for which you wish to run system tests
        required: true
        default: prod
  workflow_call:
    inputs:
      sys_test_env:
        type: string
        description: Environment of your service for which you wish to run system tests
        required: true
        default: prod
concurrency: system-tests-${{ inputs.sys_test_env }}
jobs:
  run-system-tests:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: "3.11"
      - uses: actions/setup-node@v3
        with:
          node-version: 18.17.1
      - id: poetry-cache
        uses: actions/cache@v3
        with:
          path: ~/.local
          key: poetry-1.6.1-0
      - uses: snok/install-poetry@v1
        with:
          version: 1.6.1
          virtualenvs-create: true
          virtualenvs-in-project: true
      - name: MOCK TESTING
        run: echo mock
    #   - name: AWS login with PROD credentials
    #     if: ${{ inputs.sys_test_env == 'prod' }}
    #     uses: aws-actions/configure-aws-credentials@v2
    #     with:
    #       aws-access-key-id: ${{ secrets.ROOFTOP_SOLAR_PROD_AWS_ACCESS_KEY_ID }}
    #       aws-secret-access-key: ${{ secrets.ROOFTOP_SOLAR_PROD_AWS_SECRET_KEY }}
    #       aws-region: us-east-1
    #   - name: AWS login with DEV credentials
    #     if: ${{ inputs.sys_test_env != 'prod' }}
    #     uses: aws-actions/configure-aws-credentials@v2
    #     with:
    #       aws-access-key-id: ${{ secrets.ROOFTOP_SOLAR_DEV_AWS_ACCESS_KEY_ID }}
    #       aws-secret-access-key: ${{ secrets.ROOFTOP_SOLAR_DEV_AWS_SECRET_KEY }}
    #       aws-region: us-east-1
    #   - run: |-
    #       aws codeartifact login --tool pip --domain energysage --domain-owner 659694780082 --repository cloud-engineering
    #       aws codeartifact login --tool npm --domain energysage --domain-owner 659694780082 --repository cloud-engineering
    #       poetry config http-basic.codeartifact aws $(aws codeartifact get-authorization-token --domain energysage --domain-owner 659694780082 --query authorizationToken --output text)
    #  # - run: poetry install --no-interaction --no-root
    #   # - run: npx projen
    #   # - env:
    #   #     SYS_TEST_ENV: ${{ inputs.sys_test_env }}
    #   #   run: npx projen system_tests
    #   - name: Install requirements
    #     run: pip install -r requirements.txt
    #   - name: Run system tests
    #     env:
    #       SYS_TEST_ENV: ${{ inputs.sys_test_env }}
    #     run: python system_tests.py